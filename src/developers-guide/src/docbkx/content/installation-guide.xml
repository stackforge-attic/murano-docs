<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (c) 2013 Mirantis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<chapter xmlns="http://docbook.org/ns/docbook"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xsi:schemaLocation="http://docbook.org/ns/docbook http://www.docbook.org/xml/5.0/xsd/docbook.xsd
http://www.w3.org/1999/xlink http://www.w3.org/1999/xlink.xsd"
         version="5.0">
    <title>Install Murano</title>
    <para>This chapter describes Murano services installation in virtual environment.</para>
    <para>Note that all Murano modules can be downloaded from
        <link xlink:href="https://launchpad.net/murano/">our page</link>
        on launchpad.
    </para>
    <section xml:id="prerequisites">
        <title>Pre-Requisites</title>
        <para>Murano supports the following operating systems:</para>
        <orderedlist>
            <listitem>
                <para>Ubuntu 12.04</para>
            </listitem>
            <listitem>
                <para>RHEL/CentOS 6.4</para>
            </listitem>
        </orderedlist>
        <para>These system packages are required for Murano:</para>
        <para><emphasis>Ubuntu</emphasis></para>
        <orderedlist>
            <listitem>
                <para>gcc</para>
            </listitem>
            <listitem>
                <para>python-pip</para>
            </listitem>
            <listitem>
                <para>python-dev</para>
            </listitem>
            <listitem>
                <para>libxml2-dev</para>
            </listitem>
            <listitem>
                <para>libxslt-dev</para>
            </listitem>
            <listitem>
                <para>libffi-dev</para>
            </listitem>
        </orderedlist>
        <para>
            <emphasis>CentOS</emphasis>
        </para>
        <orderedlist>
            <listitem>
                <para>gcc</para>
            </listitem>
            <listitem>
            <para>python-pip</para>
            </listitem>
            <listitem>
                <para>python-devel</para>
            </listitem>
            <listitem>
                <para>libxml2-devel</para>
            </listitem>
            <listitem>
                <para>libxslt-devel</para>
            </listitem>
            <listitem>
                <para>libffi-devel</para>
            </listitem>
        </orderedlist>
        <para>
            All these packages will be installed in murano-installation scripts. In addition to these packages some repositories are required.
            Please follow the instructions in the appendix to admin guide to prepare your environment for murano installation.
        </para>
    </section>
    <section xml:id="venv">
        <title>Installing with virtual environment</title>
        <para>
            For a local development, all Murano components can be installed in
            a virtual environment.
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        Install virtaulenv package if you don't have one:
                        <programlisting>
sudo pip install virtualenv
                        </programlisting>

                    </para>
                </listitem>
                <listitem>
                    <para>Check out git repository with murano component:
                    </para>
                    <itemizedlist>
                        <listitem>
                                <programlisting>
git clone https://github.com/stackforge/murano-api
                                </programlisting>
                        </listitem>
                        <listitem>
                                <programlisting>
git clone https://github.com/stackforge/murano-conductor
                                </programlisting>
                        </listitem>
                        <listitem>
                                <programlisting>
git clone https://github.com/stackforge/murano-dashboard
                                </programlisting>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>
                        Make sure that required system packages are installed.
                        Check list from <link linkend="prerequisites"> prerequisites page</link>
                    </para>
                </listitem>
                <listitem>
                        <para>
                            Execute a script in the <filename>tools</filename> directory
                                to create virtual environment automatically:
                            <programlisting>
$ python murano-api/tools/install_venv.py
$ python murano-conductor/tools/install_venv.py
$ python murano-dashboard/tools/install_venv.py
                            </programlisting>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        For <emphasis role="bold"> Murano Dashboard </emphasis>additional installation need to be done:
                        <itemizedlist>
                            <listitem>
                                <para>
                                    Openstack dashboard (horizon).:
                                    <programlisting>
./tools/with_venv.sh pip install https://github.com/openstack/horizon/archive/grizzly-2.tar.gz
                                    </programlisting>
                                </para>
                            </listitem>
                            <listitem>
                                <para>
                                    Install openstack-dashboard dependency:
                                    <itemizedlist>
                                        <listitem>
                                            <para>
                                                <emphasis>Ubuntu</emphasis>
                                                <programlisting>
# apt-get install nodejs
                                                </programlisting>
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>
                                                <emphasis>CentOS</emphasis>
                                                <programlisting>
# yum install nodejs
                                                </programlisting>
                                            </para>
                                        </listitem>
                                    </itemizedlist>

                                </para>
                            </listitem>
                            <listitem>
                                <para>
                                    Customized Djblets package to support datagrid element (installation by pip is not supported):
                                <programlisting>
./tools/with_venv.sh easy_install https://github.com/tsufiev/djblets/archive/master.zip
                                </programlisting>
                                </para>
                            </listitem>

                        </itemizedlist>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Config files for the development infrastructure of murano-api and murano-conductor can be found at <filename>etc</filename>
                        under folder with component repository. In murano-api and murano-conductor config file (located under ./etc directory)
                        just point out IP address where your RabbitMQ is running. All other possible configuration described in the Murano Admin Guide.
                        To configure Murano Dashboard copy
                        <programlisting>
# cp muranodashboard/local/local_settings.py.example muranodashboard/local/local_settings.py
                        </programlisting>
                        set the actual IP address of the OpenStack end-point.
                        If you haven't register murano-api service in the keystone catalog you can set MURANO_API_URL in the same settings file.
                        Note that local murano-api service will be using by default.
                    </para>
                </listitem>
                <listitem>
                    <para>Run Murano API:
                        <programlisting>
./tools/with_venv.sh python api/cmd/api.py --config-file=./etc/murano-api.conf
                        </programlisting>
                    </para>
                </listitem>
                <listitem>
                    <para>Run Murano Conductor:
                        <programlisting>
./tools/with_venv.sh python muranoconductor/cmd/run.py --config-file=./etc/conductor.conf
                        </programlisting>
                    </para>
                </listitem>
                <listitem>
                    <para><emphasis>Run Murano Dashboard:</emphasis>
                        To start the Murano development server use the Django
                        manage.py utility with the context of the virtual
                        environment:
                        <programlisting>
./tools/with_venv.sh ./manage.py runserver 0.0.0.0:8080
                        </programlisting>
                    </para>
                </listitem>
            </itemizedlist>
    </section>
</chapter>