<?xml version="1.0" encoding="UTF-8"?>
<!--
 Copyright (c) 2013 Mirantis, Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<chapter xmlns="http://docbook.org/ns/docbook"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xsi:schemaLocation="http://docbook.org/ns/docbook http://www.docbook.org/xml/5.0/xsd/docbook.xsd
                          http://www.w3.org/1999/xlink http://www.w3.org/1999/xlink.xsd"
      version="5.0">
    <title>Environments</title>
    <para>
        <emphasis role="bold"> Murano Environment </emphasis> - a virtual unit to store different services (applications).
        They can be connected with each other or be individual. The following actions with environment are available:
        <itemizedlist>
            <listitem>
                <para>Create</para>
            </listitem>
            <listitem>
                <para>Delete</para>
            </listitem>
            <listitem>
                <para>Deploy</para>
            </listitem>
        </itemizedlist>
        More information about actions with environment are described in this chapter.
    </para>
    <section>
        <title>Creating environment</title>
        <para>Once you installed all Murano components and login to horizon dashboard successfully you will see Murano tab:</para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata  fileref="../images/env_panel.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            First thing you need to do is to create an environment.
            To do this, navigate to the "Environments" page and click the "Create Environment". After setting name to your virtual environment it will be created.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/env_btn.png" scalefit="1"
                           width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            Just created environment has status <emphasis>Ready to configure</emphasis>.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/env_created.png" scalefit="1"
                           width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
    </section>
    <section>
        <title>Creating service prototype</title>
        <para >
            All services should be created in the context of Environment. After Environment is created, you need to create services prototypes
            and then deploy the Environment. When deploy process is done instances
            with your services will be spawned in Openstack.
            To create a service prototype navigate to page with the list of environment services by
            clicking on the environment name (or on the "Services" button) and then, click
            the "Create Service" button.
        </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/service_btn.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        <para>
            You have an opportunity to create one of the following services:
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/service_list.png" scalefit="1" width="100%" contentdepth="50%" />
            </imageobject>
        </mediaobject>
        <para>
            Once you choose service that you want to create click "Next" and fill the form.
            Forms for each service are specific.
            To see more information about filling the form for a specific service follow one of the link below:
        </para>
        <itemizedlist>
             <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="ASP">ASP.NET Service:</link>
                    </emphasis>
                    is a server-side Web application framework designed for Web
                    development to produce dynamic Web pages. Service is able
                    to install custom application onto one IIS Web Server. Murano installs
                    all needed components and makes proper configuration.
            </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="ASPfarm">ASP.NET Farm Service:</link>
                    </emphasis>
                    ASP.NET Farm Service installs a custom application on a
                    load-balanced array of IIS servers
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold"><link linkend="AD">Active Directory:</link></emphasis>
                    Active Directory is a directory service implemented by Microsoft for Windows domain networks.
                    In one installation, in addition to primary Domain Controller,
                    you can add optional count of secondary Domain Controllers.
                    Any other services you are intending to create can be
                    joined to that domain.
            </para>
            </listitem>
             <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="Apache">Apache Service:</link></emphasis>
                   Apache HTTP Server is a web server application notable for playing a key role in the initial growth of the World Wide Web.
                   This service can install Apache with PHP module or without it.
                </para>
            </listitem>
             <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="Demo">Demo Service:</link></emphasis>
                    Installs test service that demonstrates how to Murano interconnects with Murano Demo Agent.
                    For this service light-weight Linux Cirros image can be used.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="IIS">Internet Information Service:</link></emphasis>
                    IIS is a web server and a set of feature extension modules.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="IISfarm">Internet Information Web Farm Service:</link>
                    </emphasis>
                    Murano installs the Web Farm Framework on the controller server,
                    configures the primary server and prepares the secondary servers.
                    In addition load balancer is installed to monitor service statuses.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold"><link linkend="Telnet">Linux Telnet:</link></emphasis>
                    Telnet - is a network protocol used to provide a bidirectional interactive
                    text-oriented communication facility using a virtual terminal connection.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold"><link linkend="SQL">MS SQL Service:</link></emphasis>
                    Microsoft SQL Service is a relational database management system.
                </para>
            </listitem>
            <listitem>
                <para>
                    <emphasis role="bold">
                        <link linkend="SQLfarm">SQL Server Failover Cluster:</link>
                    </emphasis>
                    Murano installs all needed components and configures your
                    SQL Server Cluster the way you want.
                </para>
            </listitem>
        </itemizedlist>
        <para>
            On the last step of creating service prototype you have opportunity to set
            the hardware flavor of the instance which will be created -
            and the image with the operating system, which will be installed on
            the instance. Also you may select availability zone, if there are more
            then one in your environment.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/last_step.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <section  xml:id="AD">
            <title>Active Directory</title>
            <para>
                After you picked the Active Directory service in service creation
                wizard you'll see the following form:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/active_directory.png" width="100%" contentdepth="100%" format="PDF" />
                </imageobject>
            </mediaobject>
            <para>
                Enter or select values for this fields:
            </para>
            <informaltable rules="all" frame="border"
                           width="100%" cellpadding="3" cellspacing="3">
                <col width="25%" align="left" style="font-weight:bold" valign="top"/>
                <col width="70%" style="padding:6px"/>
                <tbody>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Domain name</para>
                        </td>
                        <td >
                            <para>
                                Enter a desired name for a new domain. This name should fit to
                                DNS Domain Name requirements: it should contain
                                only A-Z, a-z, 0-9, (.) and (-) and should not end with a dash.
                                DNS server will be automatically set up on each of the Domain
                                Controller instances.
                                Period characters are allowed only when they
                                are used to delimit the components of domain style
                                names. Single-level domain is not appropriate.
                                Note: Only first 15 characters or characters
                                before first period is used as NetBIOS name.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Instance Count</para></td>
                        <td>
                            <para>
                                You can create several Active Directory instances by setting
                                instance number larger than one. One primary
                                Domain Controller                                and a few secondary DCs will be created.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Account Name</para></td>
                        <td >
                            <para>
                               You account will have Active Directory administrator rights.
                               So initial value is "Administrator" but you can change it to any name you like.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Administrator password</para></td>
                        <td>
                            <para>
                                Windows requires strong password for service administration.
                                Your password should have at least one letter
                                in each
                                register, a number and a special character.
                                Password length should be
                                a minimum of 7 characters.

                                Once you forget your password you won't be able
                                to
                                operate the service until recovery password
                                would be entered. So it's
                                better for Recovery and Administrator password
                                to be different.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Confirm password</para></td>
                        <td>
                            <para>Password confirmation is required.</para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Recovery password</para></td>
                        <td>
                            <para>
                                Restrictions are the same as for the Administrator password.
                                Please provide password that is  different from Administrator.
                                It's not required for form validation though.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td><para>Confirm password</para></td>
                        <td>
                            <para>Password confirmation is required.</para>
                        </td>
                    </tr>
                </tbody>
            </informaltable>
        </section>
        <section xml:id="IIS">
            <title>Internet Information Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/iis.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="IISfarm">
            <title>Internet Information Web Farm Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/iis_farm.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="ASP">
            <title>ASP.NET Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/asp_net.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="ASPfarm">
            <title>ASP.NET Farm Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/asp_net_farm.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="SQL">
            <title>MS SQL Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/sql.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="SQLfarm">
            <title>SQL Server Failover Cluster</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/cluster1.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <para>Enter or select values for the following fields:</para>
            <informaltable rules="all" frame="border" width="100%" cellpadding="3"
                           cellspacing="3">
                <col width="25%" align="left" style="font-weight:bold"
                     valign="top"/>
                <col width="70%" style="padding:6px"/>
                <tbody>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Service Name</para>
                        </td>
                        <td>
                            <para>
                                Enter a desired name for a service. Just A-Z,
                                a-z, 0-9, dash and underline are allowed.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>Administrator password</para>
                        </td>
                        <td>
                            <para>
                                Windows requires strong password for service
                                administration.
                                Your password should have at least one letter
                                in each register, a number and a special character.
                                Password length should be a minimum of 7 characters.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>Confirm password</para>
                        </td>
                        <td>
                            <para>Password confirmation is required.</para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>Active Directory is configured by the System Administrator
                            </para>
                        </td>
                        <td>
                            <para>
                                Enable this option only if you have properly configured rules
                                that will include service to the domain, that already exists in you environment.
                                Once you set this option to true, additional fields will appear. (See information below)
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>Domain</para>
                        </td>
                        <td>
                            <para>
                                Service should be joined to the Active
                                Directory
                                domain. Please, create Active Directory Service
                                prototype first.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>Mixed-mode Authentication</para>
                        </td>
                        <td>
                            <para>
                                Mixed authentication mode allows the use of Windows
                                credentials but supplements them with local SQL
                                Server user accounts that the administrator may create and
                                maintain within SQL Server. If this mode is on SA password is required
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <para>SA Password</para>
                        </td>
                        <td>
                            <para>
                                Set system administrator password for the MS SQL Server.
                                Password requirements are the same as previous.
                            </para>
                        </td>
                    </tr>
                </tbody>
            </informaltable>
            <para>
                In case pre-configured AD is enabled following fields will appeared:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/cluster1a.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <informaltable rules="all" frame="border" width="100%" cellpadding="3"
                           cellspacing="3">
                <col width="25%" align="left" style="font-weight:bold"
                     valign="top"/>
                <col width="70%" style="padding:6px"/>
                <tbody>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Active Directory User</para>
                            <para>Active Directory Password</para>
                        </td>
                        <td>
                            <para>
                                Specify administrator user credentials to the existent AD domain
                                (to which service service will be join according to your system automation setup)
                            </para>
                        </td>
                    </tr>
                </tbody>
            </informaltable>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/cluster2.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/cluster3.png" scalefit="1"
                               width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
         <section xml:id="Apache">
            <title>Linux Apache Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/apache.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <informaltable rules="all" frame="border" width="100%" cellpadding="3"
                           cellspacing="3">
                <col width="25%" align="left" style="font-weight:bold"
                     valign="top"/>
                <col width="70%" style="padding:6px"/>
                <tbody>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Service Name</para>
                        </td>
                        <td>
                            <para>
                                Enter a desired name for a service. Just A-Z,
                                a-z, 0-9, dash and underline are allowed.
                            </para>
                        </td>
                    </tr>
                     <tr>
                        <td style="font-weight:bold">
                            <para>PHP module</para>
                        </td>
                        <td>
                            <para>
                               PHP module can be installed with Apache.
                               Enable or disable this options via checkbox.
                            </para>
                        </td>
                    </tr>
                     <tr>
                        <td style="font-weight:bold">
                            <para>Key Pair</para>
                        </td>
                        <td>
                            <para>
                                Select SSH Key Pair from the existing to
                                control access to your instance.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Hostname</para>
                        </td>
                        <td>
                            <para>
                                Machine hostname.
                                If blank - random name will be used.
                            </para>
                        </td>
                    </tr>
                </tbody>
            </informaltable>
        </section>
        <section  xml:id="Telnet">
             <title>Linux Telnet Service</title>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/telnet.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <informaltable rules="all" frame="border" width="100%" cellpadding="3"
                           cellspacing="3">
                <col width="25%" align="left" style="font-weight:bold"
                     valign="top"/>
                <col width="70%" style="padding:6px"/>
                <tbody>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Service Name</para>
                        </td>
                        <td>
                            <para>
                                Enter a desired name for a service. Just A-Z,
                                a-z, 0-9, dash and underline are allowed.
                            </para>
                        </td>
                    </tr>
                     <tr>
                        <td style="font-weight:bold">
                            <para>Key Pair</para>
                        </td>
                        <td>
                            <para>
                                Select SSH Key Pair from the existing.
                            </para>
                        </td>
                    </tr>
                    <tr>
                        <td style="font-weight:bold">
                            <para>Hostname</para>
                        </td>
                        <td>
                            <para>
                                Machine hostname.
                                If blank - random name will be used.
                            </para>
                        </td>
                    </tr>
                </tbody>
            </informaltable>
        </section>
    </section>
    <section>
        <title>Deploying environment</title>
        <para>
            Once all services are prepared you can send environment to deploy.
            Just press the "Deploy Environment" button.
        </para>
        <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/deploy_btn.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
        </mediaobject>
        <para>
            And you'll see a message about successful start of deploying your services in Openstack. Since now all you have to do is just wait for a little bit
            while Murano installing and configuring your services.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/deploy_started.png" scalefit="1"
                           width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            You can monitor deploying process. Just go to the Log tab on service
            detailed page, where you can get by clicking on the service name.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/service_name.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            And now you can see installation progress.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/logs.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            As long as installation and configuration are in progress, environment
            is in <emphasis>Deploy in progress</emphasis> state. Depending on how many
            services you are deploying or how many nodes in your cluster, process of spawning instances,
            installation and post installation settings takes from 10 minutes up to one hour.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/env_deploy.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            If installation process finished without any errors, environment changes its status to
            <emphasis>Ready:</emphasis>
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/done.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
    </section>
    <section>
        <title>Working with deployed environment</title>
        <para>
            Congratulations! After some time waiting you are able to operate with the services.
            To get information about installed services, navigate to service detailed page.
            To do that click on the environment name and then on the name of the service you what to know about.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/iis_farm_detail.png" scalefit="1" width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>
            Now you are seeing general information about the service in terms of Murano Environment.
            To get information about the instance in Openstack terms follow the link on service instance name.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/name_link.png" scalefit="1"/>
            </imageobject>
        </mediaobject>
        <para>
            You can login to the virtual machine directly from the horizon (if your Openstack installation allows you) or by RDP protocol.
        </para>
        <mediaobject>
            <imageobject role="fo">
                <imagedata fileref="../images/instance_console.png" scalefit="1"
                           width="100%" contentdepth="100%"/>
            </imageobject>
        </mediaobject>
        <para>There are more things you can do with Murano Environment:</para>
        <itemizedlist>
            <listitem>
                <para><link linkend="redeploy">Add new services and deploy it again;</link></para>
            </listitem>
            <listitem>
                <para><link linkend="delete">Delete outdated and unnecessary environments or services;</link></para>
            </listitem>
            <listitem>
                <para><link linkend="deployments">Browse deployment history and service installation logs;</link></para>
            </listitem>
            <listitem>
                <para><link linkend="edit">Rename your environment.</link></para>
            </listitem>
        </itemizedlist>
        <section xml:id="redeploy">
            <title>Redeploying Murano Environment</title>
            <para>
                Murano gives an opportunity to supplement already deployed environment.
                Thus if you already deployed the Active Directory service and want to add
                any other services just create desired service prototype and click the "Deploy This Environment" button.
                During service prototype creation you can join this service to the existent Active Directory domain.
            </para>
        </section>
        <section xml:id="delete">
            <title>Deleting</title>
            <para>Services as well as environments can be easily deleted.</para>
            <itemizedlist>
                <listitem>
                    <para>To delete an environment go to the environment index page and click "More" -> "Delete Environment" in Actions column of ready to delete environment.</para>
                    <mediaobject>
                        <imageobject role="fo">
                            <imagedata fileref="../images/env_delete.png"
                                       scalefit="1" width="100%"
                                       contentdepth="100%"/>
                        </imageobject>
                    </mediaobject>
                    <para>
                        Environment deletion means to kill all services with instances on which they are installed.
                        Instances will be scheduled to delete right after you choose the "Delete Environment" action.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        To delete a service go service list page and click the "Delete Service" button in Actions column. <emphasis role="bold">Note:</emphasis>
                        If you are deleting service that was already deployed you'll need to <emphasis>Deploy</emphasis> the environment again by pressing corresponding button.
                        In case you want to delete service prototype - it has <emphasis>"Service draft created"</emphasis> in the <emphasis>
                        Last operation</emphasis> column (see the screenshot below) - changes applies right away.
                    </para>
                    <mediaobject>
                        <imageobject role="fo">
                            <imagedata fileref="../images/service_delete.png"
                                       scalefit="1" width="100%"
                                       contentdepth="100%"/>
                        </imageobject>
                    </mediaobject>
                </listitem>
            </itemizedlist>
        </section>
        <section xml:id="deployments">
            <title>Browsing Murano Deployment</title>
            <para>
                Since Murano Environment can be deployed many times you may want
                to see the history of its deployments. To do that click the "More-> Show deployments"
                button on environments index page:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/env_show.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <para>
                From this page it's easy to see how many times and when Murano Environment was deployed:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/deployments.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <para>
                For each deployment you can get a detailed information by clicking the "Show Details" button.
                You always can go back to any level using navigation string at the page header.
                From here you can observe what services were installed during deployment:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/deployment_configuration.png"
                               scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <para>Also deployment logs are available at the "Logs" tab:</para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata
                            fileref="../images/deployment_logs.png"
                            scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
        <section xml:id="edit">
            <title>Renaming Murano Environment</title>
            <para>
                It's possible to change a name of your environment: just click the "More-> Edit Environment" button on environment index page:
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/env_edit.png" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
            <para>
                Environment name is not involved in service creation process so you can use spaces and any other
                characters you want.
            </para>
            <mediaobject>
                <imageobject role="fo">
                    <imagedata fileref="../images/env_edit2.png" scalefit="1"
                               width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </section>
    </section>
    <section xml:id="trouble">
        <title>Troubleshooting</title>
            <para><emphasis role="bold"> How to debug OpenStack Heat?</emphasis></para>
            <para>
                If you can execute Heat command via console interface - all good. It is
                the most simple way to check Heat state on the node - just execute CLI
                command 'heat list'.

                See more information about Heat in openstack wiki
                <link xlink:href="https://wiki.openstack.org/wiki/Heat/TroubleShooting"> page</link>
            </para>
            <para><emphasis role="bold"> If 'heat list' returns 503 error</emphasis></para>
            <para>
                It means that OpenStack Heat configuration files contain incorrect
                credentials. Need to set 'user' = 'heat' and change passwords
                'verybadpass' in all configuration files from directory /etc/heat/
            </para>
            <para><emphasis role="bold">If 'heat list' hangs up</emphasis></para>
            <para>
                Sometimes you can see that 'heat list' hangs up. The root of this
                problem - connection to the rabbitMQ.
            </para>
            <para><emphasis role="bold">How I can connect to LoadBalancer instance in Server Farms?</emphasis></para>
            <para>
                First of all you should have KeyPair file 'murano-lb-key'. You can
                create this file using commands
                <programlisting>
                    <![CDATA[
nova keypair-add murano-lb-key > murano-lb-key.priv
chmod 600 murano-lb-key.priv
                    ]]>
                </programlisting>
                And after that server farms need to be created with this KeyPair.
                The second step is to 'how to connect to VM with LoadBalancer':
                <programlisting>
                <![CDATA[
ssh -i murano-lb-key.priv root@10.0.0.3
                ]]>
              </programlisting>
            </para>
            <para><emphasis role="bold">Murano dashboard can not connect to Murano API. How I can fix it?</emphasis></para>
            <para>
                This problem has two ways to fix:
                Add string
                    <programlisting>
                        <![CDATA[
MURANO_API_URL='http://localhost:8082'
                                ]]>
                    </programlisting>
                to the /etc/openstack-dashboard/local_settings (or
                /etc/openstack-dashboard/local_settings.py - it depends on OpenStack
                configuration)
                and after that web server restart is needed.
                Add keystone endpoints for Murano API
                    <programlisting>
                        <![CDATA[
keystone service-create --name muranoapi --type murano --description "Murano-Api Service"
keystone endpoint-create --region RegionOne --service-id
--publicurl http://localhost:8082 --internalurl http://localhost:8082 --adminurl http://localhost:8082
                    ]]>
                </programlisting>
            </para>
            <para><emphasis role="bold">
                Murano API Service does not work on CentOS 6.x. WebUI can not connect
                to this service. How to fix this?</emphasis>
                </para>
            <para>
                The problem in pip lib routes. Need to upgrade this lib and restart
                Murano API:
                <programlisting>
                    <![CDATA[
python-pip install routes --upgrade
initctl stop murano-api
initctl start murano-api
                ]]>
            </programlisting>
            </para>
            <para><emphasis role="bold">
                Error 'Unexpected state' during the deployment of Web Farms. What the
                problem? </emphasis>
            </para>
            <para>
                Sometimes we can see in deployments logs:
                <programlisting>
                    <![CDATA[
2013-08-06 09:10:07 - Unable to deploy instance ipkrmhk0vzq4b6 (asp-farm_instance_0) due to Unexpected state
2013-08-06 09:10:07 - Unable to create a Server Farm load balancer on unit ipkrmhk0vzq4b6 (asp-farm_instance_0) due to Unexpected state
                                ]]>
                </programlisting>
                The root of this problem is incorrect configuration - Heat can not
                create Load Balancer instance. Please, remember that you should have
                admin access for the project in OpenStack to deploy LoadBalancer and also,
                you should have KeyPair with default name 'murano-lb-key'.
            </para>
            <para><emphasis role="bold">Error in Murano API logs 'No module named helpers.token_sanitizer'</emphasis></para>
             <para>
                This pip version problem. Need to install pip 1.4 and after that reinstall murano-client, murano-common and murano-api.
            </para>
    </section>
</chapter>
